{% extends "base.html" %}
{% block Content %}
<div class="container-fluid">
    <h1>Identifier 5 objectifs SMART validés avec votre héarchie</h1>
<form method="POST">
    {% csrf_token %}
    {% for message in messages %}
                <div class="alert {{ message.tags }} alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                    </button>
                    {{ message }}
                </div>
                {% endfor %}
     <div id="objectif-details" align="center"></div>
     <div id="dynamicCheck">
        <button type="button" id="ajout-objectif" class="btn btn-success">Ajouter un Objectif</button>
     </div>
     <div align="right">
        <button type="submit" class="btn btn-primary" >Envoyer</button>
    </div>
  </form>
</div>
{% endblock %}
{% block fiche_objectif_jquery %}
  <script type="text/JavaScript">
      let i=0;
      let j=0;
      $("#ajout-objectif").click(function(e){

          let id_objectif_count = ++i;
          let div_objectif_id_empty = 'div_objectif';
          let div_objectif_id = div_objectif_id_empty+id_objectif_count;
          let objectif_id = '{{ form.objectif.id_for_label }}' + id_objectif_count;
          let poids_id = '{{ form.poids.id_for_label }}' + id_objectif_count;
          let objectif_div = "<div id="+div_objectif_id+"></div>";
          let button_sous_objectif_id = 'ajout-sous-objectif'+id_objectif_count;
          $('#objectif-details').append(objectif_div);

        let objectif =   "<label for="+objectif_id+" >Objectif " + id_objectif_count + "</label>"
        +"<textarea id="+objectif_id+" name='{{ form.FIELD_NAME_MAPPING.objectif }}' class='form-control' rows='3'></textarea>"
        +'{{form.objectif.errors}}'
        +"<label for="+poids_id+" >poids en %</label>"
        +"<input class='form-control' type='number' name='{{ form.FIELD_NAME_MAPPING.poids }}' id="+poids_id+">"
        +'{{ form.poids.errors }}'
        +"<button type='button' id="+button_sous_objectif_id+" data-value="+id_objectif_count+" class='btn btn-success'>Ajouter un Sous-Objectif</button>";
        $('#' + div_objectif_id).append(objectif);

        // Ajout des sous objectifs

            $("#"+ button_sous_objectif_id).click(function(e){
                let id_sous_objectif_count = ++j;
                let sous_objectif_id = '{{ form.sous_objectif.id_for_label }}' + id_sous_objectif_count;
                let sous_objectif = "<input id="+sous_objectif_id+" name='{{ form.FIELD_NAME_MAPPING.sous_objectif }}' class='form-control' type='text'>"
                                    +'{{ form.sous_objectif.errors }}';
                $('#'+ div_objectif_id_empty+$(this).data("value")).append(sous_objectif);
                $(this).insertBefore()
            });
      });
    </script>
        {% endblock %}